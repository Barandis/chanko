/*!
 * Copyright (c) 2020 Thomas Otterson
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to 
 * deal in the Software without restriction, including without limitation the 
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or 
 * sell copies of the Software, and to permit persons to whom the Software is 
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in 
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
 * DEALINGS IN THE SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.chanko=t():e.chanko=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var u=t[r]={i:r,l:!1,exports:{}};return e[r].call(u.exports,u,u.exports,n),u.l=!0,u.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)n.d(r,u,function(t){return e[t]}.bind(null,u));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"f",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return a})),n.d(t,"e",(function(){return s}));const r=Symbol("empty"),u=Symbol("queue");function o(){return Object.create(null,{store:{value:[],writable:!0},pointer:{value:0,writable:!0},[u]:{value:!0}})}function i(e){return e.store.length-e.pointer}function c(e,t){e.store.push(t)}function a(e){if(0===e.store.length)return r;const t=e.store[e.pointer];return 2*++e.pointer>=e.store.length&&(e.store=e.store.slice(e.pointer),e.pointer=0),t}function s(e,t){for(let n=0,r=i(e);n<r;n++){const n=a(e);t(n)&&c(e,n)}}},function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return v}));var r=n(0);const u=Object(r.f)(),o=Symbol("setImmediate"),i=Symbol("MessageChannel"),c=Symbol("setTimeout"),a={batchSize:1024,dispatchMethod:o};let s=d(),f=!1,l=!0;function d(){switch(function(){switch(a.dispatchMethod){case i:return"undefined"!=typeof MessageChannel?i:c;case c:return c;default:return void 0!==e?o:"undefined"!=typeof MessageChannel?i:c}}()){case o:return()=>{l&&f||(l=!0,e(m))};case i:{const e=new MessageChannel;return e.port1.onmessage=()=>m(),()=>{l&&f||(l=!0,e.port2.postMessage(0))}}case c:return()=>{l&&f||(l=!0,setTimeout(m,0))}}}function m(){f=!0,l=!1;let e=0;for(;;){const t=Object(r.c)(u);if(t===r.a)break;if(t(),e>=a.batchSize)break;e++,f=!1,Object(r.b)(u)&&s()}}function b(e=null){if(null===e)return Object.assign({},a);for(const t in a)t in e&&(a[t]=e[t],"dispatchMethod"===t&&(s=d()))}function v(e){Object(r.d)(u,e),s()}}).call(this,n(3).setImmediate)},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,u=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(u.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(u.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(4),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(2))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,u,o,i,c,a=1,s={},f=!1,l=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){b(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){b(e.data)},r=function(e){o.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(u=l.documentElement,r=function(e){var t=l.createElement("script");t.onreadystatechange=function(){b(e),t.onreadystatechange=null,u.removeChild(t),t=null},u.appendChild(t)}):r=function(e){setTimeout(b,0,e)}:(i="setImmediate$"+Math.random()+"$",c=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(i)&&b(+t.data.slice(i.length))},e.addEventListener?e.addEventListener("message",c,!1):e.attachEvent("onmessage",c),r=function(t){e.postMessage(i+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var u={callback:e,args:t};return s[a]=u,r(a),a++},d.clearImmediate=m}function m(e){delete s[e]}function b(e){if(f)setTimeout(b,0,e);else{var t=s[e];if(t){f=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{m(e),f=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(2),n(5))},function(e,t){var n,r,u=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var a,s=[],f=!1,l=-1;function d(){f&&a&&(f=!1,a.length?s=a.concat(s):l=-1,s.length&&m())}function m(){if(!f){var e=c(d);f=!0;for(var t=s.length;t;){for(a=s,s=[];++l<t;)a&&a[l].run();l=-1,t=s.length}a=null,f=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function b(e,t){this.fun=e,this.array=t}function v(){}u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new b(e,t)),1!==s.length||f||c(m)},b.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=v,u.addListener=v,u.once=v,u.off=v,u.removeListener=v,u.removeAllListeners=v,u.emit=v,u.prependListener=v,u.prependOnceListener=v,u.listeners=function(e){return[]},u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(e,t,n){"use strict";n.r(t);var r=n(0);const u=Symbol("buffer"),o=Symbol("fixed"),i=Symbol("dropping"),c=Symbol("sliding");function a(e){return Object.create(null,{queue:{value:Object(r.f)()},size:{value:e},[u]:{value:o}})}function s(e){return Object.create(null,{queue:{value:Object(r.f)()},size:{value:e},[u]:{value:i}})}function f(e){return Object.create(null,{queue:{value:Object(r.f)()},size:{value:e},[u]:{value:c}})}function l(e){return e.size}function d(e){return Object(r.b)(e.queue)}function m(e){return e[u]===o&&Object(r.b)(e.queue)>=e.size}function b(e,...t){switch(e[u]){case o:for(const n of t)Object(r.d)(e.queue,n);break;case i:for(const n of t)d(e)<l(e)&&Object(r.d)(e.queue,n);break;case c:for(const n of t)d(e)>=l(e)&&Object(r.c)(e.queue),Object(r.d)(e.queue,n);break;default:return}}function v(e){return Object(r.c)(e.queue)}const p=Object.create(null,{init:{value:Symbol.for("transducer/init")},step:{value:Symbol.for("transducer/step")},result:{value:Symbol.for("transducer/result")},reduced:{value:Symbol.for("transducer/reduced")},value:{value:Symbol.for("transducer/value")}});var h=n(1);const y=Symbol("box"),O=Symbol("closed");function g(e){return!!(null==e?void 0:e[p.reduced])}function j(e){return Object.create(null,{value:{value:e,writable:!0},[y]:{value:!0}})}function T(e,t,n){if(t===O)throw Error("Cannot send CLOSED to a channel");if(e.closed)return n.commit(),j(!1);let u,o;if(e.buffer&&!m(e.buffer)){n.commit();const i=g(e.xform[p.step](e.buffer,t));for(;0!==d(e.buffer)&&(u=Object(r.c)(e.recvs),u!==r.a);)if(u.active){o=u.commit();const t=v(e.buffer);o&&Object(h.e)(()=>o(t))}return i&&w(e),j(!0)}for(;u=Object(r.c)(e.recvs),u!==r.a;)if(u.active)return n.commit(),o=u.commit(),o&&Object(h.e)(()=>o(t)),j(!0);if(e.dirtySends>e.maxDirty?(Object(r.e)(e.sends,e=>e.handler.active),e.dirtySends=0):e.dirtySends++,Object(r.b)(e.sends)>=e.maxQueued)throw Error(`No more than ${e.maxQueued} pending sends are allowed on a single channel`);return Object(r.d)(e.sends,function(e,t){return Object.create(null,{value:{value:e,writable:!0},handler:{value:t},[y]:{value:!0}})}(t,n)),null}function w(e){if(e.closed)return;let t,n,u;if(e.closed=!0,e.buffer)for(e.xform[p.result](e.buffer);0!==d(e.buffer)&&(t=Object(r.c)(e.recvs),t!==r.a);)if(t.active){u=t.commit();const n=v(e.buffer);u&&Object(h.e)(()=>u(n))}for(;t=Object(r.c)(e.recvs),t!==r.a;)t.active&&(u=t.commit(),u&&Object(h.e)(()=>u(O)));for(;n=Object(r.c)(e.sends),n!==r.a;)n.handler.active&&(u=n.handler.commit(),u&&Object(h.e)(()=>u(!1)))}const x=()=>O;function S(e){return Object.create(null,{active:{value:!0},commit:{value:()=>e}})}function E(e,t,n){const r=t(n);return r!==O&&b(e,r),e}function I(e,t=x){return{[p.step](n,r){try{return e[p.step](n,r)}catch(e){return E(n,t,e)}},[p.result](n){try{return e[p.result](n)}catch(e){return E(n,t,e)}}}}const M={[p.init](){throw Error("init not available")},[p.step]:(e,t)=>(b(e,t),e),[p.result]:e=>e};function _(e,t,n){let r,o;var i;e?"number"==typeof e?(r=a(e),o=t):(null==(i=e)?void 0:i[u])?(r=e,o=t):(r=(null==e?void 0:e.transducer)?a(1):null,o=e):(r=null,o=t);const{transducer:c,handler:s,maxDirty:f,maxQueued:l,timeout:d}=Object.assign({},n,o);return{buf:r,transducer:c,handler:s,maxDirty:f,maxQueued:l,timeout:d}}function k(e,t){const n={maxDirty:64,maxQueued:1024},{buf:u,transducer:o,handler:i,maxDirty:c,maxQueued:a,timeout:s}=_(e,t,n);if(o&&!u)throw Error("Only buffered channels can use transducers");const f=function(e,t,n=64,u=1024){return Object.create(null,{buffer:{value:e},xform:{value:t},maxDirty:{value:n},maxQueued:{value:u},recvs:{value:Object(r.f)()},sends:{value:Object(r.f)()},dirtyRecvs:{value:0,writable:!0},dirtySends:{value:0,writable:!0},closed:{value:!1,writable:!0}})}(u,I(o?o(M):M,i),c,a),l="number"==typeof s;return l&&setTimeout(()=>w(f),s),Object.create(null,{impl:{value:f},isBuffered:{value:!!u},isTimed:{value:l}})}function C(e=0){return k({timeout:e})}function P(e,t){return k({transducer:e,handler:t})}function q(e){return e.impl.closed}function D(e){return e.isBuffered}function L(e){return e.isTimed}function A(e,t,n=(()=>{})){const r=T(e.impl,t,S(n));r&&n&&n(r.value)}function Q(e,t=(()=>{})){const n=function(e,t){let n,u,o;if(e.buffer&&d(e.buffer)>0){t.commit();const i=v(e.buffer);for(;!m(e.buffer)&&(n=Object(r.c)(e.sends),n!==r.a);)u=n.handler,u.active&&(o=u.commit(),o&&Object(h.e)(()=>o(!0)),g(e.xform[p.step](e.buffer,n.value))&&w(e));return j(i)}for(;n=Object(r.c)(e.sends),n!==r.a;)if(u=n.handler,u.active)return o=u.commit(),o&&Object(h.e)(()=>o(!0)),j(n.value);if(e.closed)return t.commit(),j(O);if(e.dirtyRecvs>e.maxDirty?(Object(r.e)(e.recvs,e=>e.active),e.dirtyRecvs=0):e.dirtyRecvs++,Object(r.b)(e.recvs)>=e.maxQueued)throw Error(`No more than ${e.maxQueued} pending receives are allowed on a single channel`);return Object(r.d)(e.recvs,t),null}(e.impl,S(t));n&&t&&t(n.value)}function z(e,t){return new Promise(n=>{A(e,t,n)})}function F(e){return new Promise(t=>{Q(e,t)})}function N(e){return new Promise((t,n)=>{Q(e,e=>{Object.prototype.isPrototypeOf.call(Error.prototype,e)?n(e):t(e)})})}function R(e){w(e.impl)}function $(e=0){return new Promise(t=>{Q(C(e),t)})}function B(e,...t){return e(...t)}n.d(t,"fixed",(function(){return a})),n.d(t,"dropping",(function(){return s})),n.d(t,"sliding",(function(){return f})),n.d(t,"CLOSED",(function(){return O})),n.d(t,"chan",(function(){return k})),n.d(t,"timedChan",(function(){return C})),n.d(t,"transChan",(function(){return P})),n.d(t,"send",(function(){return z})),n.d(t,"recv",(function(){return F})),n.d(t,"sendAsync",(function(){return A})),n.d(t,"recvAsync",(function(){return Q})),n.d(t,"recvOrThrow",(function(){return N})),n.d(t,"close",(function(){return R})),n.d(t,"isClosed",(function(){return q})),n.d(t,"isBuffered",(function(){return D})),n.d(t,"isTimed",(function(){return L})),n.d(t,"config",(function(){return h.d})),n.d(t,"SET_IMMEDIATE",(function(){return h.b})),n.d(t,"MESSAGE_CHANNEL",(function(){return h.a})),n.d(t,"SET_TIMEOUT",(function(){return h.c})),n.d(t,"go",(function(){return B})),n.d(t,"sleep",(function(){return $})),n.d(t,"EMPTY",(function(){return r.a}))}])}));