<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>xdcore/src/modules/iteration.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-csp.html">csp</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-csp.html#.chan">chan</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.channel">channel</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.close">close</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.config">config</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.dropping">dropping</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.fixed">fixed</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.go">go</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.isBuffered">isBuffered</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.isClosed">isClosed</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.isTimed">isTimed</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.join">join</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.recv">recv</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.recvAsync">recvAsync</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.recvOrThrow">recvOrThrow</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.select">select</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.selectAsync">selectAsync</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.send">send</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.sendAsync">sendAsync</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.sleep">sleep</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.sliding">sliding</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.timedChan">timedChan</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.transChan">transChan</a></li><li data-type='method' style='display: none;'><a href="module-csp.html#.value">value</a></li></ul></li><li><a href="module-csp-ops.html">csp-ops</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.debounce">debounce</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.map">map</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.merge">merge</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.partition">partition</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.pipe">pipe</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.reduce">reduce</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.split">split</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.tap">tap</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.throttle">throttle</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.toArray">toArray</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.toChannel">toChannel</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.untap">untap</a></li><li data-type='method' style='display: none;'><a href="module-csp-ops.html#.untapAll">untapAll</a></li></ul></li><li><a href="module-xdcore.html">xdcore</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-xdcore.html#.complete">complete</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.ensureCompleted">ensureCompleted</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.ensureUncompleted">ensureUncompleted</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.isArray">isArray</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.isCompleted">isCompleted</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.isFunction">isFunction</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.isGeneratorFunction">isGeneratorFunction</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.isImplemented">isImplemented</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.isIterable">isIterable</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.isNumber">isNumber</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.isObject">isObject</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.isString">isString</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.iterator">iterator</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.reduce">reduce</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.toFunction">toFunction</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.toReducer">toReducer</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.toTransducer">toTransducer</a></li><li data-type='method' style='display: none;'><a href="module-xdcore.html#.uncomplete">uncomplete</a></li></ul></li><li><a href="module-xduce.html">xduce</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-xduce.html#.asArray">asArray</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.asIterator">asIterator</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.asObject">asObject</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.asString">asString</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.complement">complement</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.compose">compose</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.identity">identity</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.into">into</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.key">key</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.kv">kv</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.repeat">repeat</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.sequence">sequence</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.transduce">transduce</a></li><li data-type='method' style='display: none;'><a href="module-xduce.html#.value">value</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-Iterable.html">Iterable</a></li><li><a href="external-Iterator.html">Iterator</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">xdcore/src/modules/iteration.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Copyright (c) 2020 Thomas J. Otterson
 *
 * This software is released under the MIT License.
 * https://opensource.org/licenses/MIT
 */

/**
 * Functions to help with iteration over iterable objects and plain objects.
 *
 * @module xdcore/iteration
 * @private
 */

import { isImplemented } from "modules/protocol";
import { isFunction, isObject, isGeneratorFunction } from "modules/utils";

/**
 * Creates an iterator over an object.
 *
 * Details about this function are included in the documentation for
 * {@link module:xdcore.iterator|iterator}.
 *
 * @param {object} obj The object being iterated over.
 * @returns {external:Iterator} An iterator over the properties of `obj`.
 * @private
 */
function objectIterator(obj) {
  return (function*() {
    const keys = Object.keys(obj);
    let index = 0;

    while (index &lt; keys.length) {
      const k = keys[index++];
      yield { [k]: obj[k] };
    }
  })();
}

/**
 * Creates an iterator over a function.
 *
 * Details about this function are included in the documentation for
 * {@link module:xdcore.iterator|iterator}.
 *
 * @param {module:xdcore.IterableFunction} fn The function to iterate over.
 * @returns {external:Iterator} An iterator over the return values of `fn`.
 * @private
 */
function functionIterator(fn) {
  return (function*() {
    let current;
    let index = 0;

    for (;;) {
      current = fn(index++, current);
      if (typeof current === "undefined") {
        break;
      }
      yield current;
    }
  })();
}

/**
 * Creates an iterator over the provided value. The form of the iteration
 * depends on what kind of value is being iterated over.
 *
 * If the value is a collection implementing the [iterable protocol][1] (arrays,
 * strings, generators, or a custom object supporting the protocol) then the
 * produced iterator will be as expected: an object that implements the
 * [iterator protocol][2] by providing a `next` function that returns each
 * collection value in turn.
 *
 * ```
 * const iter = iterator([1, 2, 3]);
 * console.log(iter.next().value);   // -> 1
 * console.log(iter.next().value);   // -> 2
 * console.log(iter.next().value);   // -> 3
 * console.log(iter.next().done);    // -> true
 * ```
 *
 * Special support is provided for two types that are not normally iterable:
 * objects and functions.
 *
 * Objects result in an iterator that produces a single-property object for
 * every key/value pair in the supplied object. The [order of iteration][3] is
 * the same as it is for objects post-ES2015:
 *
 * 1. String keys that are integer indices in ascending numerical order
 * 2. All other string keys in the order in which they were added to the object
 * 3. All symbol keys in the order in which they were added to the object
 *
 * ```
 * const obj = {
 *   [Symbol("first")]: true,
 *   02: true,
 *   10: true,
 *   01: true,
 *   2: true,
 *   [Symbol("second")]: true
 * };
 * const iter = iterator(obj);
 * console.log(iter.next().value);   // -> { '2': true }
 * console.log(iter.next().value);   // -> { '10': true }
 * console.log(iter.next().value);   // -> { '02': true }
 * console.log(iter.next().value);   // -> { '01': true }
 * console.log(iter.next().value);   // -> { [Symbol('first')]: true }
 * console.log(iter.next().value);   // -> { [Symbol('second')]: true }
 * console.log(iter.next().done);    // -> true
 * ```
 *
 * Functions are run each time the iterator's `next` method is called, and the
 * return value of the function is supplied as the iterator's value at that
 * point.
 *
 * This function is provided two arguments: the zero-based index of that
 * iteration, and the value produced by the last invocation of the iterator. The
 * last value is `undefined` on the first pass, but a default parameter on the
 * function can define the first pass value to be whatever is needed.
 *
 * ```
 * const fn = (index, last = 1) => last * (index + 1);
 * const iter = iterator(fn);
 * console.log(iter.next().value);   // -> 1
 * console.log(iter.next().value);   // -> 2
 * console.log(iter.next().value);   // -> 6
 * console.log(iter.next().value);   // -> 24
 * console.log(iter.next().value);   // -> 120
 * ```
 *
 * Iterators created from functions are, by default, infinite since there is no
 * condition for them to not be able to be applied one more time. To create a
 * finite iterator from a function, have it return `undefined` at some point.
 * When a return value of `undefined` is encountered, `iterator` will terminate
 * the iterator, setting its next `done` property to `true`.
 *
 * If the input value is neither iterable, object, or function, then the result
 * will be `null`.
 *
 * [1]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#The_iterable_protocol
 * [2]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#The_iterator_protocol
 * [3]: https://2ality.com/2015/10/property-traversal-order-es6.html
 *
 * @memberof module:xdcore
 * @param {(object|module:xdcore.IterableFunction|external:Iterable)} value
 *     The value to create an iterator over.
 * @returns {external:Iterator} An iterator over `value`.
 */
function iterator(value) {
  switch (true) {
    case isFunction(value[Symbol.iterator]):
    case isGeneratorFunction(value[Symbol.iterator]):
      return value[Symbol.iterator]();
    case isFunction(value):
      return functionIterator(value);
    case isObject(value):
      return objectIterator(value);
    default:
      return null;
  }
}

/**
 * Determines whether the passed object is iterable, in terms of what 'iterable'
 * means to this library. In other words, values implementing the `iterable`
 * protocol and plain objects return `true`, while everything else returns
 * `false`. This does not return `true` for functions even though
 * {@link module:xdcore.iterator|iterator} can produce an iterator for them,
 * because not all functions work well with
 * {@link module:xdcore.iterator|iterator}.
 *
 * @memberof module:xdcore
 * @param {*} value The value to test for iterability.
 * @return {boolean} Either `true` if the value is iterable
 *     (`{@link module:xdcore.iterator|iterator}` will return an iterator for
 *     it) or `false` if it is not.
 */
function isIterable(value) {
  return isImplemented(value, "iterator") || isObject(value);
}

export { iterator, isIterable };
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Thu Apr 02 2020 06:30:07 GMT-0400 (Eastern Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
